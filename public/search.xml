<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>ggplot2 完全解析 EP.01 从 0 到 1</title>
      <link href="/2026/01/27/ggplot2%E5%AE%8C%E5%85%A8%E8%A7%A3%E6%9E%90EP-01/"/>
      <url>/2026/01/27/ggplot2%E5%AE%8C%E5%85%A8%E8%A7%A3%E6%9E%90EP-01/</url>
      
        <content type="html"><![CDATA[<h1 id="ggplot2-完全解析-EP-01-从-0-到-1"><a href="#ggplot2-完全解析-EP-01-从-0-到-1" class="headerlink" title="ggplot2 完全解析 EP.01 从 0 到 1"></a>ggplot2 完全解析 EP.01 从 0 到 1</h1><h2 id="视频教程"><a href="#视频教程" class="headerlink" title="视频教程"></a>视频教程</h2><div style="position: relative; width: 100%; height: 0; padding-bottom: 56.25%;"><iframe src="//player.bilibili.com/player.html?isOutside=true&aid=113486021594973&bvid=BV17QmoYHEU9&cid=26770738940&p=1" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true" style="position: absolute; width: 100%; height: 100%; left:0; top: 0"></iframe></div><h2 id="内容简介"><a href="#内容简介" class="headerlink" title="内容简介"></a>内容简介</h2><ol><li>ggplot2 中会使用到的基本元件</li><li>使用 ggplot2 需要了解的基本概念</li><li>不同种类元件的具体用法浅析</li><li>实例解析 - 小提琴箱线散点图</li></ol><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>科研成果的呈现绘图是必不可少的，支持科研图标绘制的工具有很多，比如可视化操作下的 Graphpad Prism、Origin 等等，或者 Python 中的 matplotlib、seaborn、plotly 等等，这些工具我平常也都会用到，主要根据具体环境选择，但是说到生信分析当中的可视化，我还是唯独钟爱 ggplot2，它的简介性、语法一致性、结构完整性、可拓展性都是别的绘图系统不能比的，所以在此开一个坑介绍一下它的各种实际用法。</p><p>在讲到具体的各种奇技淫巧之前，还是需要这样一个总起性的章节对这个好用、易用、实用的绘图系统有一个基本的了解</p><h2 id="ggplot2-中会使用到的基本元件"><a href="#ggplot2-中会使用到的基本元件" class="headerlink" title="ggplot2 中会使用到的基本元件"></a>ggplot2 中会使用到的基本元件</h2><ol><li>geom 类：geom 是 geometry 的缩写，函数的格式类似 <code>geom_point()</code>&#x2F;<code>geom_line()</code>&#x2F;<code>geom_*()</code> 等等，主要负责使用原始数据直接绘制各种图形，是一张图标中最主要的部分；</li><li>stat 类: stat 是 statistics 的缩写，函数的格式类似 <code>stat_smooth()</code>&#x2F;<code>stat_qq()</code>&#x2F;<code>stat_*()</code> 等等，负责对原始数据进行统计处理，比如 <code>stat_smooth()</code> 函数会根据原始数据进行回归分析，并返回预测值，<code>stat_qq()</code> 函数会根据原始数据进行 QQ 检验，并返回结果，是在原始数据的基础上进一步进行统计描述；</li><li><code>annotate()</code> 函数：标注函数，用于在图片上添加自定义注释，比如强调某个点；</li><li>scale 类： 函数的格式类似 <code>scale_x_continuous()</code>&#x2F;<code>scale_y_discrete()</code>&#x2F;<code>scale_*()</code> 等等，负责调整坐标轴、颜色、尺寸、透明度等各种标尺的映射，适当的使用可以使图片更美观或者使需要强调的内容更突出；</li><li>各种主题相关函数：如 theme 类、coord 类、facet 类、guide 类等等，还有 <code>ggtitle()</code>&#x2F;<code>labs()</code> 这些散在的函数，负责调整图片的样式，比如主题风格、坐标轴比例、 分面等等，这些函数的格式类似 <code>theme_classic()</code>&#x2F;<code>coord_polar()</code>&#x2F;<code>facet_grid()</code>&#x2F;<code>guide_legend()</code> 等等，主要影响图片的美术风格和展示样式，本文主要只对 theme 类稍作展开。</li></ol><p>对于 geom 类、stat 类、scale 类，我统称为图形类，因为他们都构成了主图的图形，scale 类我又称为标尺类。对于一张完整的图，图形类的元素是<strong>必不可少</strong>的，而标尺类与主题类都是锦上添花，而一张完整的图片，就是由这些基本元素排列组合而成的。</p><h2 id="ggplot2-的基本概念"><a href="#ggplot2-的基本概念" class="headerlink" title="ggplot2 的基本概念"></a>ggplot2 的基本概念</h2><h3 id="代码块的基本构成"><a href="#代码块的基本构成" class="headerlink" title="代码块的基本构成"></a>代码块的基本构成</h3><p>首先，我们通常看到的代码块，由各个元件通过 <code>+</code> 号连接构成，比如：</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 遵循 tidyverse 推荐格式</span></span><br><span class="line">panel <span class="operator">&lt;-</span></span><br><span class="line">    ggplot<span class="punctuation">(</span>...<span class="punctuation">)</span> <span class="operator">+</span>      <span class="comment"># 头部，必须存在，声明一个图形的启动</span></span><br><span class="line">    geom_<span class="operator">*</span><span class="punctuation">(</span>...<span class="punctuation">)</span> <span class="operator">+</span>      <span class="comment"># 图形类中的三种元素至少要出现一个，否则就是空白图</span></span><br><span class="line">    stat_<span class="operator">*</span><span class="punctuation">(</span>...<span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">    annotate<span class="punctuation">(</span>...<span class="punctuation">)</span> <span class="operator">+</span>    </span><br><span class="line">    scale_<span class="operator">*</span><span class="punctuation">(</span>...<span class="punctuation">)</span> <span class="operator">+</span>     <span class="comment"># 下列各种标尺类和主题类都非必须，但是如果真的都不放，图片会很丑</span></span><br><span class="line">    ggtitle<span class="punctuation">(</span>...<span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">    labs<span class="punctuation">(</span>...<span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">    theme_<span class="operator">*</span><span class="punctuation">(</span>...<span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">    ...</span><br></pre></td></tr></table></figure><p>很有趣的一点是，ggplot2 在 python 中也得到了几乎完全的移植，如 plotnine，在 python 中，格式略有不同，但是我因为对齐清爽更喜欢这种格式，在 R 语言中也常照搬如下格式：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">panel = (</span><br><span class="line">    ggplot(...)</span><br><span class="line">    + geom_*(...)</span><br><span class="line">    + stat_*(...)</span><br><span class="line">    + annotate(...)</span><br><span class="line">    + scale_*(...)</span><br><span class="line">    + ggtitle(...)</span><br><span class="line">    + labs(...)</span><br><span class="line">    + theme_*(...)</span><br><span class="line">    + ...</span><br><span class="line">)</span><br></pre></td></tr></table></figure><h2 id="输入数据的格式"><a href="#输入数据的格式" class="headerlink" title="输入数据的格式"></a>输入数据的格式</h2><p>ggplot2 的输入数据必须是 <code>data.frame</code> 格式，当然，作为 tidyverse 家族的一员，<code>tibble</code> 这种更严格的 <code>data.frame</code> 也是兼容的。</p><p>对于 <code>data.frame</code> 这一类表格数据，通常有长表与宽表之分：</p><p><strong>长表</strong>是指表格的每一行是一个样本，而每一列代表了样本的一个属性，比如：</p><table><thead><tr><th>id</th><th>颜色</th><th>大小</th><th>名称</th></tr></thead><tbody><tr><td>1</td><td>红</td><td>大</td><td>苹果</td></tr><tr><td>2</td><td>红</td><td>小</td><td>樱桃</td></tr><tr><td>3</td><td>紫</td><td>大</td><td>山竹</td></tr><tr><td>4</td><td>紫</td><td>小</td><td>葡萄</td></tr></tbody></table><p>而<strong>宽表</strong>内的每一个数据都是一个样本，行名和列名用来定位属性，比如：</p><table><thead><tr><th>大小\颜色</th><th>红</th><th>紫</th></tr></thead><tbody><tr><td>大</td><td>苹果</td><td>山竹</td></tr><tr><td>小</td><td>樱桃</td><td>葡萄</td></tr></tbody></table><p>在 ggplot2 中，必须使用长表数据，如果你手上的数据是宽表数据也不用担心，有很多种方法可以转换为长表数据，比如 reshape2 包中的 <code>melt()</code> 函数，或者用 tidyr 包中的 <code>pivot_longer()</code> 函数，当然，后者作为 tidyverse 分析流程中的一员，是更为推荐的。</p><p>比如我们通过大小为横坐标，颜色为纵坐标，可以把四种水果的标签标记在相应的象限上：</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">panel <span class="operator">&lt;-</span></span><br><span class="line">    ggplot<span class="punctuation">(</span></span><br><span class="line">        data    <span class="operator">=</span> fruit<span class="punctuation">,</span></span><br><span class="line">        mapping <span class="operator">=</span> aes<span class="punctuation">(</span></span><br><span class="line">            x     <span class="operator">=</span> `大小`<span class="punctuation">,</span></span><br><span class="line">            y     <span class="operator">=</span> `颜色`<span class="punctuation">,</span></span><br><span class="line">            label <span class="operator">=</span> `名称`</span><br><span class="line">        <span class="punctuation">)</span></span><br><span class="line">    <span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">    geom_text<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line">panel</span><br></pre></td></tr></table></figure><p><img src="/2026/01/27/ggplot2%E5%AE%8C%E5%85%A8%E8%A7%A3%E6%9E%90EP-01/1_fruit.png"></p><h2 id="全局数据与局部数据"><a href="#全局数据与局部数据" class="headerlink" title="全局数据与局部数据"></a>全局数据与局部数据</h2><p>我们来观察如下两个代码块</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">panel <span class="operator">&lt;-</span></span><br><span class="line">    ggplot<span class="punctuation">(</span></span><br><span class="line">        data    <span class="operator">=</span> dat<span class="punctuation">,</span></span><br><span class="line">        mapping <span class="operator">=</span> aes<span class="punctuation">(</span></span><br><span class="line">            x     <span class="operator">=</span> x<span class="punctuation">,</span></span><br><span class="line">            y     <span class="operator">=</span> y<span class="punctuation">,</span></span><br><span class="line">            label <span class="operator">=</span> label</span><br><span class="line">        <span class="punctuation">)</span></span><br><span class="line">    <span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">    geom_point<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">    geom_text<span class="punctuation">(</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">panel <span class="operator">&lt;-</span></span><br><span class="line">    ggplot<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">    geom_point<span class="punctuation">(</span></span><br><span class="line">        data    <span class="operator">=</span> dat1<span class="punctuation">,</span></span><br><span class="line">        mapping <span class="operator">=</span> aes<span class="punctuation">(</span></span><br><span class="line">            x <span class="operator">=</span> x1<span class="punctuation">,</span></span><br><span class="line">            y <span class="operator">=</span> y1</span><br><span class="line">        <span class="punctuation">)</span></span><br><span class="line">    <span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">    geom_text<span class="punctuation">(</span></span><br><span class="line">        data    <span class="operator">=</span> dat2<span class="punctuation">,</span></span><br><span class="line">        mapping <span class="operator">=</span> aes<span class="punctuation">(</span></span><br><span class="line">            x <span class="operator">=</span> x2<span class="punctuation">,</span></span><br><span class="line">            y <span class="operator">=</span> y2<span class="punctuation">,</span></span><br><span class="line">            label <span class="operator">=</span> label</span><br><span class="line">        <span class="punctuation">)</span></span><br><span class="line">    <span class="punctuation">)</span></span><br></pre></td></tr></table></figure><p>在第一个代码块中，所有的数据包括标尺数据都写在 <code>ggplot()</code> 函数中，这代表着之后跟着的所有绘图元素，比如 <code>geom_point()</code>、<code>geom_text()</code>，都会使用 <code>dat</code> 这个数据集进行绘图，我们称为全局数据；在第二个代码块中，数据集 <code>dat1</code> 和 <code>dat2</code> 分别被 <code>geom_point()</code> 和 <code>geom_text()</code> 函数所使用，两种图形依据不同的数据绘制，互不干扰，这被称为局部数据。</p><p>大部分情况下，主图中的内容都写在全局数据中，但是对于一些特殊的标注，就会用到局部数据，比如我们绘制差异基因火山图时，全局数据用于绘制所有基因的散点图，但是对于我们关注的基因，我们就会用局部数据绘制几个单独的点：</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">panel_volcano <span class="operator">&lt;-</span></span><br><span class="line">    ggplot<span class="punctuation">(</span></span><br><span class="line">        data    <span class="operator">=</span> deg<span class="punctuation">,</span>                 <span class="comment"># 全局数据，包含了所有基因</span></span><br><span class="line">        mapping <span class="operator">=</span> aes<span class="punctuation">(</span></span><br><span class="line">            x     <span class="operator">=</span> log2FoldChange<span class="punctuation">,</span></span><br><span class="line">            y     <span class="operator">=</span> <span class="operator">-</span>log10<span class="punctuation">(</span>pvalue<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">            color <span class="operator">=</span> regulation</span><br><span class="line">        <span class="punctuation">)</span></span><br><span class="line">    <span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">    geom_point<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span>                     <span class="comment"># 继承自全局数据，绘制所有基因</span></span><br><span class="line">    geom_point<span class="punctuation">(</span></span><br><span class="line">        data    <span class="operator">=</span> deg_highlight<span class="punctuation">,</span>       <span class="comment"># 添加单独的局部变量，高亮关注的基因</span></span><br><span class="line">        mapping <span class="operator">=</span> aes<span class="punctuation">(</span></span><br><span class="line">            x     <span class="operator">=</span> log2FoldChange<span class="punctuation">,</span></span><br><span class="line">            y     <span class="operator">=</span> <span class="operator">-</span>log10<span class="punctuation">(</span>pvalue<span class="punctuation">)</span></span><br><span class="line">        <span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">        color   <span class="operator">=</span> <span class="string">&quot;black&quot;</span>              <span class="comment"># 改变这些高亮点的颜色做出区分</span></span><br><span class="line">    <span class="punctuation">)</span></span><br><span class="line">panel_volcano</span><br></pre></td></tr></table></figure><p>如果只使用全局变量，结果就如下图：</p><p><img src="/2026/01/27/ggplot2%E5%AE%8C%E5%85%A8%E8%A7%A3%E6%9E%90EP-01/2_global.png"></p><p>而因为我们添加了局部变量，所以有标记我们关注的基因，如下图：</p><p><img src="/2026/01/27/ggplot2%E5%AE%8C%E5%85%A8%E8%A7%A3%E6%9E%90EP-01/3_local.png"></p><h3 id="变量属性与常量属性"><a href="#变量属性与常量属性" class="headerlink" title="变量属性与常量属性"></a>变量属性与常量属性</h3><p>我们再观察如下的代码块与对应的图片：</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">panel <span class="operator">&lt;-</span></span><br><span class="line">    ggplot<span class="punctuation">(</span></span><br><span class="line">        data    <span class="operator">=</span> fruit<span class="punctuation">,</span></span><br><span class="line">        mapping <span class="operator">=</span> aes<span class="punctuation">(</span></span><br><span class="line">            x     <span class="operator">=</span> `大小`<span class="punctuation">,</span></span><br><span class="line">            y     <span class="operator">=</span> `颜色`<span class="punctuation">,</span></span><br><span class="line">            label <span class="operator">=</span> `名称`<span class="punctuation">,</span></span><br><span class="line">            color <span class="operator">=</span> `名称`</span><br><span class="line">        <span class="punctuation">)</span></span><br><span class="line">    <span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">    geom_text<span class="punctuation">(</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><p><img src="/2026/01/27/ggplot2%E5%AE%8C%E5%85%A8%E8%A7%A3%E6%9E%90EP-01/4_variable.png"></p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">panel <span class="operator">&lt;-</span></span><br><span class="line">    ggplot<span class="punctuation">(</span></span><br><span class="line">        data    <span class="operator">=</span> fruit<span class="punctuation">,</span></span><br><span class="line">        mapping <span class="operator">=</span> aes<span class="punctuation">(</span></span><br><span class="line">            x     <span class="operator">=</span> `大小`<span class="punctuation">,</span></span><br><span class="line">            y     <span class="operator">=</span> `颜色`<span class="punctuation">,</span></span><br><span class="line">            label <span class="operator">=</span> `名称`</span><br><span class="line">        <span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">        color   <span class="operator">=</span> <span class="string">&quot;red&quot;</span></span><br><span class="line">    <span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">    geom_text<span class="punctuation">(</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><p><img src="/2026/01/27/ggplot2%E5%AE%8C%E5%85%A8%E8%A7%A3%E6%9E%90EP-01/5_constant.png"></p><p>两段代码中，只有 <code>color</code> 属性的位置和值不同，前者 <code>color</code> 放在<code>aes()</code> 内部，基于水果的名称分配绘图颜色，所以每种水果的绘图颜色不同，因而称为变量属性；后者 <code>color</code> 放在 <code>aes()</code> 之外，基于常量值 <code>&quot;red&quot;</code>，所以所有水果的绘图颜色都是红色，为常量属性。</p><p>变量属性的作用是基于样本的不同属性为绘图元素分配不同外观，比如在通路富集气泡图中根据 p 值的大小分配颜色、根据基因的个数分配点的大小，等等；而常量属性的作用是统一规定图形的外观，比如把图中所有文字的大小都规定为 4。</p><p>变量属性与常量属性的区别只在于是否在 <code>aes()</code> 内，切不要与全局数据和局部数据混淆了。</p><h3 id="图层"><a href="#图层" class="headerlink" title="图层"></a>图层</h3><p>最后我们观察这一对代码块：</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">panel <span class="operator">&lt;-</span></span><br><span class="line">    ggplot<span class="punctuation">(</span></span><br><span class="line">        data    <span class="operator">=</span> mtcars<span class="punctuation">,</span></span><br><span class="line">        mapping <span class="operator">=</span> aes<span class="punctuation">(</span></span><br><span class="line">            x <span class="operator">=</span> factor<span class="punctuation">(</span>gear<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">            y <span class="operator">=</span> mpg</span><br><span class="line">        <span class="punctuation">)</span></span><br><span class="line">    <span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">    geom_boxplot<span class="punctuation">(</span></span><br><span class="line">        fill <span class="operator">=</span> <span class="string">&#x27;red&#x27;</span></span><br><span class="line">    <span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">    geom_violin<span class="punctuation">(</span></span><br><span class="line">        fill <span class="operator">=</span> <span class="string">&#x27;blue&#x27;</span></span><br><span class="line">    <span class="punctuation">)</span></span><br><span class="line">panel</span><br></pre></td></tr></table></figure><p><img src="/2026/01/27/ggplot2%E5%AE%8C%E5%85%A8%E8%A7%A3%E6%9E%90EP-01/6_violin.png"></p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">panel <span class="operator">&lt;-</span></span><br><span class="line">    ggplot<span class="punctuation">(</span></span><br><span class="line">        data    <span class="operator">=</span> mtcars<span class="punctuation">,</span></span><br><span class="line">        mapping <span class="operator">=</span> aes<span class="punctuation">(</span></span><br><span class="line">            x <span class="operator">=</span> factor<span class="punctuation">(</span>gear<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">            y <span class="operator">=</span> mpg</span><br><span class="line">        <span class="punctuation">)</span></span><br><span class="line">    <span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">    geom_violin<span class="punctuation">(</span></span><br><span class="line">        fill <span class="operator">=</span> <span class="string">&#x27;blue&#x27;</span></span><br><span class="line">    <span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">    geom_boxplot<span class="punctuation">(</span></span><br><span class="line">        fill <span class="operator">=</span> <span class="string">&#x27;red&#x27;</span></span><br><span class="line">    <span class="punctuation">)</span></span><br><span class="line">panel</span><br></pre></td></tr></table></figure><p><img src="/2026/01/27/ggplot2%E5%AE%8C%E5%85%A8%E8%A7%A3%E6%9E%90EP-01/7_boxplot.png"></p><p>两个示例中，<code>boxplot</code> 与 <code>violin</code> 的顺序不同，因而输出的图片中两种图形覆盖的顺序不同，总而言之，靠后的代码绘制的图形会覆盖靠前的代码绘制的图形。</p><h2 id="不同种类元件的具体用法浅析"><a href="#不同种类元件的具体用法浅析" class="headerlink" title="不同种类元件的具体用法浅析"></a>不同种类元件的具体用法浅析</h2><h3 id="图形类"><a href="#图形类" class="headerlink" title="图形类"></a>图形类</h3><p>以 <code>geom_point()</code> 为例，主要的属性有：</p><ol><li><code>x, y</code>：位置；</li><li><code>color</code>：颜色，若为实心形状则为整体颜色，若为空心图形则为边缘颜色；</li><li><code>fill</code>：填充颜色，只在空心图形中有效；</li><li><code>shape</code>：形状，常用的如 0 为 ■，1 为 ●，22为 □，21 为 ○，等等；</li><li><code>size</code>：大小；</li><li><code>alpha</code>：透明度，取值范围 0-1，0 表示完全透明，1 表示完全不透明。</li></ol><p>这些属性都可用作变量属性或作常量属性。</p><h3 id="标尺类"><a href="#标尺类" class="headerlink" title="标尺类"></a>标尺类</h3><p>以 <code>scale_color_manual</code> 为例，主要的属性有：</p><ol><li><code>name</code>：名称，显示在图例中，说明颜色标注的是哪个属性；</li><li><code>breaks</code>：刻度，与 <code>values</code> 对应；</li><li><code>values</code>：颜色，与 <code>breaks</code> 对应，规定具体的颜色，比如 <code>breaks = c(&quot;苹果&quot;， &quot;梨&quot;), values = c(&quot;red&quot;, &quot;blue&quot;)</code>，那么苹果的颜色就是红色，梨的颜色就是蓝色；</li><li><code>labels</code>：标签，与 <code>breaks</code> 对应，比如 <code>breaks = c(&quot;苹果&quot;， &quot;梨&quot;), labels = c(&quot;apple&quot;， &quot;pear&quot;)</code>，那么苹果对应的标签就是 apple，梨对应的标签就是 pear。</li></ol><p>不同的 <code>scale_*()</code> 函数的具体属性差异巨大，具体还要查阅文档。</p><h3 id="主题类"><a href="#主题类" class="headerlink" title="主题类"></a>主题类</h3><p>1、 theme 类：ggplot2 提供了各种预设的主题，比如 <code>theme_classic()</code>、<code>theme_bw()</code>、<code>theme_minimal()</code>、<code>theme_void()</code>、<code>theme_gray()</code> 等等，暂不展开自定义主题，以后聊到具体绘图的时候再讲解；<br>2. <code>labs()</code> 函数：为图形添加标题、图例、坐标轴标签等等，比如 <code>labs(title = &quot;标题&quot;, x = &quot;X 轴&quot;, y = &quot;Y 轴&quot;)</code>，等等；<br>3. <code>ggtitle()</code> 函数：另一种添加标题的方法，比如 <code>ggtitle(&quot;标题&quot;)</code>，如果不调整主题，默认显示在图片的左上角。</p><h2 id="实例解析-小提琴箱线散点图"><a href="#实例解析-小提琴箱线散点图" class="headerlink" title="实例解析 - 小提琴箱线散点图"></a>实例解析 - 小提琴箱线散点图</h2><p>话不多说，直接开画：</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">panel <span class="operator">&lt;-</span></span><br><span class="line">    ggplot<span class="punctuation">(</span></span><br><span class="line">        data    <span class="operator">=</span> mtcars<span class="punctuation">,</span>         <span class="comment"># 全局数据</span></span><br><span class="line">        mapping <span class="operator">=</span> aes<span class="punctuation">(</span></span><br><span class="line">            x <span class="operator">=</span> factor<span class="punctuation">(</span>gear<span class="punctuation">)</span><span class="punctuation">,</span>     <span class="comment"># 全局变量，规定横轴与纵轴基于的属性</span></span><br><span class="line">            y <span class="operator">=</span> mpg</span><br><span class="line">        <span class="punctuation">)</span></span><br><span class="line">    <span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">    geom_violin<span class="punctuation">(</span></span><br><span class="line">        mapping <span class="operator">=</span> aes<span class="punctuation">(</span></span><br><span class="line">            fill <span class="operator">=</span> factor<span class="punctuation">(</span>gear<span class="punctuation">)</span>   <span class="comment"># 局部变量，规定小提琴图的填充颜色基于 gear</span></span><br><span class="line">        <span class="punctuation">)</span></span><br><span class="line">    <span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">    geom_boxplot<span class="punctuation">(</span>width <span class="operator">=</span> <span class="number">0.2</span><span class="punctuation">)</span> <span class="operator">+</span>   <span class="comment"># 局部常量，规定箱线图的宽度为 0.2，避免遮挡小提琴图</span></span><br><span class="line">    geom_jitter<span class="punctuation">(</span>width <span class="operator">=</span> <span class="number">0.2</span><span class="punctuation">)</span> <span class="operator">+</span>    <span class="comment"># 局部常量，规定散点图的宽度为 0.2，避免超出箱线图范围</span></span><br><span class="line">    ggtitle<span class="punctuation">(</span>                      <span class="comment"># 添加标题</span></span><br><span class="line">        <span class="string">&quot;MPG ~ Gear&quot;</span></span><br><span class="line">    <span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">    labs<span class="punctuation">(</span>                         <span class="comment"># 添加坐标轴与图例标签</span></span><br><span class="line">        x    <span class="operator">=</span> <span class="string">&quot;Gear&quot;</span><span class="punctuation">,</span></span><br><span class="line">        y    <span class="operator">=</span> <span class="string">&quot;MPG&quot;</span></span><br><span class="line">        fill <span class="operator">=</span> <span class="string">&quot;Gear&quot;</span></span><br><span class="line">    <span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">    theme_classic<span class="punctuation">(</span><span class="punctuation">)</span>               <span class="comment"># 使用经典主题</span></span><br><span class="line">panel</span><br></pre></td></tr></table></figure><p><img src="/2026/01/27/ggplot2%E5%AE%8C%E5%85%A8%E8%A7%A3%E6%9E%90EP-01/8_violin_box_jitter.png"></p>]]></content>
      
      
      <categories>
          
          <category> 生信 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ggplot2 </tag>
            
            <tag> 绘图 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>我目前做生信分析使用的文件树</title>
      <link href="/2026/01/26/%E6%88%91%E7%9B%AE%E5%89%8D%E5%81%9A%E7%94%9F%E4%BF%A1%E5%88%86%E6%9E%90%E4%BD%BF%E7%94%A8%E7%9A%84%E6%96%87%E4%BB%B6%E6%A0%91/"/>
      <url>/2026/01/26/%E6%88%91%E7%9B%AE%E5%89%8D%E5%81%9A%E7%94%9F%E4%BF%A1%E5%88%86%E6%9E%90%E4%BD%BF%E7%94%A8%E7%9A%84%E6%96%87%E4%BB%B6%E6%A0%91/</url>
      
        <content type="html"><![CDATA[<h1 id="我目前做生信分析使用的文件树"><a href="#我目前做生信分析使用的文件树" class="headerlink" title="我目前做生信分析使用的文件树"></a>我目前做生信分析使用的文件树</h1><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>做一个好的项目，好的文件结构必不可少，一个好的文件树可以保证阅读性、可复用性和可维护性。好在生信项目的流程很固定，所以文件树也不需要那么复杂。</p><p>通常一个生信项目会包含这些步骤：数据导入-数据分析-数据可视化-数据导出-结果分析。因此我构建的文件树格式也大致如此。</p><h2 id="文件树结构"><a href="#文件树结构" class="headerlink" title="文件树结构"></a>文件树结构</h2><p>根据生信分析的一般步骤，我目前使用的文件树结构如下，目前展示的是一个以 R 语言为主的示例，当然也可以很轻松的改变为 Python 为主，或者 Python 与 R 语言混用的结构：</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">project/</span><br><span class="line">├── data/</span><br><span class="line">│    ├ raw/</span><br><span class="line">│    │    ├ GSExxxxxx_RAW/</span><br><span class="line">│    │    └ ...</span><br><span class="line">│    └ processed/</span><br><span class="line">│         ├ 1_preprocess.Rdata</span><br><span class="line">│         └ ...</span><br><span class="line">├── src/</span><br><span class="line">│    ├ main/</span><br><span class="line">│    │    ├ 1_preprocess.R</span><br><span class="line">│    └ utils/</span><br><span class="line">│         ├ plot_volcano.R</span><br><span class="line">│         └ ...</span><br><span class="line">├── output/</span><br><span class="line">│    ├ figures/</span><br><span class="line">│    │    ├ 1_preprocess/</span><br><span class="line">│    │    │    ├ 1_1_density.png</span><br><span class="line">│    │    │    └ ...</span><br><span class="line">│    │    └ ...</span><br><span class="line">│    └ tables/</span><br><span class="line">│         ├ 1_preprocess/</span><br><span class="line">│         │    ├ 1_1_expr.csv</span><br><span class="line">│         │    └ ...</span><br><span class="line">│         └ ...</span><br><span class="line">├── report/</span><br><span class="line">│    ├ 1_preprocess.md</span><br><span class="line">│    └ ...</span><br><span class="line">├── README.md</span><br><span class="line">└── ...</span><br></pre></td></tr></table></figure><ol><li><code>data/</code>：存放数据：<ol><li><code>raw/</code>：存放原始数据，按照数据来源或数据格式安排子文件夹；</li><li><code>processed/</code>：存放处理后的数据，每一个分析步骤对应一个结果文件，R 语言使用 <code>.Rdata</code> 格式，Python 可以使用 <code>.pkl</code> 或 <code>.h5ad</code> 格式等等；</li></ol></li><li><code>src/</code>：存放源代码：<ol><li><code>main/</code>：存放主要代码，每一个文件对应一个分析步骤，比如数据预处理、差异分析、富集分析等等；</li><li><code>utils/</code>：存放工具函数，比如差异分析时常需要画火山图，我就会写一个 <code>plot_volcano.R</code> ，然后在主文件中使用 <code>source(&quot;src/utils/plot_volcano.R&quot;)</code> 引入，等等，这样可以极大的提高代码的可复用性，甚至可以将工具函数写成一个包，方便其他项目使用，或者发到 CRAN 仓库，等等；</li></ol></li><li><code>output/</code>：存放输出结果：<ol><li><code>figures/</code>：存放图片，按照步骤和子步骤安排子文件夹，做好编号，对应结果产生的顺序；</li><li><code>tables/</code>：存放表格，同样按照步骤和子步骤安排子文件夹，做好编号，对应结果产生的顺序；</li><li>当然如果有其他格式的结果输出，也可以自行安排别的文件夹；</li></ol></li><li><code>report/</code>：存放报告，可以是 <code>.md</code> &#x2F; <code>.Rmd</code> 格式，也可以是 <code>.pdf</code> 格式，或者 <code>.docx</code> 格式等等，每个文件对应一个分析步骤，将分析的流程与相应的结果解释清楚呈现在报告中；</li><li><code>README.md</code>：项目描述文件，可以写一个项目简介，项目结构，项目依赖等等，这样别人可以快速了解你的项目；</li><li>其他文件， 比如 <code>LISENSE</code> 或者 <code>requirements.txt</code> 等等，根据项目需要自行添加。</li></ol><h2 id="创建文件树"><a href="#创建文件树" class="headerlink" title="创建文件树"></a>创建文件树</h2><p>每次都手动创建这么多文件夹还挺麻烦的，<code>Windows</code> 环境下我们可以使用批处理文件批量生成文件夹，<code>Linux</code> 或者 <code>Mac</code> 环境下也可以使用 <code>shell</code> 脚本批量生成文件夹。</p><h3 id="Windows"><a href="#Windows" class="headerlink" title="Windows"></a>Windows</h3><p>创建 <code>init_dir.bat</code> 文件，内容如下：</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">md</span> data</span><br><span class="line"><span class="built_in">md</span> data\raw</span><br><span class="line"><span class="built_in">md</span> data\processed</span><br><span class="line"><span class="built_in">md</span> src</span><br><span class="line"><span class="built_in">md</span> src\main</span><br><span class="line"><span class="built_in">md</span> src\utils</span><br><span class="line"><span class="built_in">md</span> output</span><br><span class="line"><span class="built_in">md</span> output\figures</span><br><span class="line"><span class="built_in">md</span> output\tables</span><br><span class="line"><span class="built_in">md</span> report</span><br><span class="line"><span class="built_in">cd</span> .&gt;README.<span class="built_in">md</span></span><br></pre></td></tr></table></figure><p>可以把 <code>init_dir.bat</code> 文件放在项目根目录下，双击即可创建文件树。</p><h3 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h3><p>创建 <code>init_dir.sh</code> 文件，内容如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> data</span><br><span class="line"><span class="built_in">mkdir</span> data/raw</span><br><span class="line"><span class="built_in">mkdir</span> data/processed</span><br><span class="line"><span class="built_in">mkdir</span> src</span><br><span class="line"><span class="built_in">mkdir</span> src/main</span><br><span class="line"><span class="built_in">mkdir</span> src/utils</span><br><span class="line"><span class="built_in">mkdir</span> output</span><br><span class="line"><span class="built_in">mkdir</span> output/figures</span><br><span class="line"><span class="built_in">mkdir</span> output/tables</span><br><span class="line"><span class="built_in">mkdir</span> report</span><br><span class="line"><span class="built_in">touch</span> README.md</span><br></pre></td></tr></table></figure><p>可以把 <code>init_dir.sh</code> 文件放在项目根目录下，然后使用 <code>bash init_dir.sh</code> 命令创建文件树。</p><h3 id="Mac"><a href="#Mac" class="headerlink" title="Mac"></a>Mac</h3><p>创建 <code>init_dir.sh</code> 文件，内容与上述 <code>Linux</code> 一样，但是 <code>.sh</code> 文件在 <code>Mac</code> 上运行时需要在终端使用 <code>sh init_dir.sh</code> 命令，很不方便，我们可以把后缀名改为 <code>.command</code>，这样 <code>init_dir.command</code> 文件就可以直接在 <code>Finder</code> 中双击运行了。</p><h2 id="其他常见的文件树结构"><a href="#其他常见的文件树结构" class="headerlink" title="其他常见的文件树结构"></a>其他常见的文件树结构</h2><p>其实更常见的文件结构是将每一个步骤单独放在一个文件夹中，比如：</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">project/</span><br><span class="line">├── 1_preprocess/</span><br><span class="line">│    ├── rawdata/</span><br><span class="line">│    ├── 1_preprocess.R</span><br><span class="line">│    ├── 1_1_density.png</span><br><span class="line">│    ├── 1_1_expr.csv</span><br><span class="line">│    ├── 1_preprocess.Rdata</span><br><span class="line">│    └── ...</span><br><span class="line">├── 2_differential_analysis/</span><br><span class="line">│    └── ...</span><br><span class="line">├── report.md</span><br><span class="line">└── ...</span><br></pre></td></tr></table></figure><p>这种结构的好处是每一个步骤所需要的文件都在同一个文件夹中，分析时不用频繁的切换目录；但是缺点是不同的文件类型放在同一个文件夹中很凌乱，也可能会发生误覆盖，而且查看结果时依然需要频繁切换目录。<em>而且我想说，现在大家写代码都会给文本编辑器配置文件树的，不用在终端或者资源管理器里切换目录，反而查看结果的时候因为要打开图片或者 <code>pdf</code> 文件才没有那么方便。</em>总之就我个人而言，我觉得我现在使用的结构更加清爽。</p><h2 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h2><p>当然我在这里也只是提供了一个参考，也不是说可以完全符合各种项目的需求，比方说一些工业化程度高的项目会用脚本或者 pipeline 管理工具来进行流水线生产，这样我的这个结构可能就不是非常适用了，当然我也在研究如何提高这方面的适配性，有新的心得了也会发布在这里，大家目前都可以根据自己的需求和项目情况来选择适合自己的文件树结构。</p>]]></content>
      
      
      <categories>
          
          <category> 生信 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 文件管理 </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
